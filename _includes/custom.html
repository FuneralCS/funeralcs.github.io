
{% if jekyll.environment == "production" %}
<script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
<script>
  window.OneSignalDeferred = window.OneSignalDeferred || [];
  OneSignalDeferred.push(async function (OneSignal) {
    await OneSignal.init({
      appId: "eec1e0dc-646d-457d-b974-b4e2c2dcbcac",
    });
  });
</script>
{% endif %}

<!--fire base-->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getDatabase, ref, onValue, runTransaction } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBuNnULimBcSpMhSH-6ZlSagp2tCtEu1uI",
    authDomain: "funeralcs-pageviews.firebaseapp.com",
    databaseURL: "https://funeralcs-pageviews-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "funeralcs-pageviews",
    storageBucket: "funeralcs-pageviews.appspot.com",
    messagingSenderId: "386030303930",
    appId: "1:386030303930:web:a27f52f766c021276b2083"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const path = window.location.pathname;
  const safePath = path.replace(/\//g, "_");
  const counterRef = ref(db, 'pageviews/' + safePath);

  // üëá Sadece ilk ziyaretse saya√ß artƒ±r
  if (!localStorage.getItem(`viewed_${safePath}`)) {
    runTransaction(counterRef, (currentViews) => {
      return (currentViews || 0) + 1;
    });

    localStorage.setItem(`viewed_${safePath}`, "true");
  }

  // üîÅ Sayacƒ± DOM‚Äôa yaz
  onValue(counterRef, (snapshot) => {
    const viewCount = snapshot.val();
    const el = document.getElementById("pageviews");
    if (viewCount && el) {
      el.innerHTML = `<i class="fas fa-eye"></i> ${viewCount} g√∂r√ºnt√ºleme`;
    }
  });
</script>
