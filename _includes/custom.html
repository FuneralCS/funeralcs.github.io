{% if jekyll.environment == "production" %}
<script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
<script>
  window.OneSignalDeferred = window.OneSignalDeferred || [];
  OneSignalDeferred.push(async function (OneSignal) {
    await OneSignal.init({
      appId: "eec1e0dc-646d-457d-b974-b4e2c2dcbcac",
    });
  });
</script>
{% endif %}

<!-- _includes/custom.html -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import {
    getDatabase,
    ref,
    onValue,
    runTransaction
  } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBuNnULimBcSpMhSH-6ZlSagp2tCtEu1uI",
    authDomain: "funeralcs-pageviews.firebaseapp.com",
    databaseURL: "https://funeralcs-pageviews-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "funeralcs-pageviews",
    storageBucket: "funeralcs-pageviews.firebasestorage.app",
    messagingSenderId: "386030303930",
    appId: "1:386030303930:web:a27f52f766c021276b2083"
  };

  // Firebase’i başlat
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // URL’den key üret (/posts/islemciler/ → _posts_islemciler_)
  const raw = window.location.pathname;
  const clean = raw.replace(/\//g, "_");
  const counterRef = ref(db, "pageviews/" + clean);

  // Tekil ziyaretçi için
  if (!localStorage.getItem("viewed_" + clean)) {
    runTransaction(counterRef, v => (v || 0) + 1);
    localStorage.setItem("viewed_" + clean, "true");
  }

  // Değeri oku ve #pageviews’e yaz
  onValue(counterRef, snap => {
    const n = snap.val();
    const el = document.getElementById("pageviews");
    if (el && n != null) {
      el.innerHTML = `<i class="fas fa-eye"></i> ${n} görüntüleme`;
    }
  });
</script>