{%- comment -%}
  Solid Language Switcher (works even on tag/author/archive pages)
  - active lang detection order:
    1) site.active_lang
    2) page.lang
    3) URL prefix (/en/, /tr/)
    4) site.default_lang
  - default_lang_in_subdir respected
  - active lang is <span>, others are <a>
{%- endcomment -%}

{%- assign langs = site.languages -%}
{%- assign def_in_sub = site.polyglot.default_lang_in_subdir | default: true -%}

{%- assign active = site.active_lang | default: page.lang -%}
{%- if active == nil or active == '' -%}
  {%- assign p = page.url | default:'/' -%}
  {%- assign seg = p | split:'/' | slice:1,1 | first -%}
  {%- if langs contains seg -%}
    {%- assign active = seg -%}
  {%- else -%}
    {%- assign active = site.default_lang -%}
  {%- endif -%}
{%- endif -%}

<div class="lang-switcher" role="navigation" aria-label="Language switcher">
  {%- for lang in langs -%}
    {%- if lang == active -%}
      <span class="pill active" aria-current="page" lang="{{ lang }}">{{ lang | upcase }}</span>
    {%- else -%}
      {%- if lang == site.default_lang and def_in_sub == false -%}
        {%- assign href = '/' -%}
      {%- else -%}
        {%- assign href = '/' | append: lang | append: '/' -%}
      {%- endif -%}
      <a class="pill" href="{{ href }}" lang="{{ lang }}" hreflang="{{ lang }}" title="Switch to {{ lang | upcase }}">{{ lang | upcase }}</a>
    {%- endif -%}
  {%- endfor -%}
</div>

<style>
.lang-switcher{display:flex;gap:.5rem;margin:.6rem 0}
.lang-switcher .pill{
  padding:.35rem .65rem;border-radius:999px;border:1px solid rgba(0,0,0,.1);
  font-weight:600;font-size:.9rem;text-decoration:none;color:inherit
}
.lang-switcher .pill:hover{background:rgba(0,0,0,.05)}
.lang-switcher .pill.active{background:rgba(0,0,0,.15);box-shadow:inset 0 -2px rgba(0,0,0,.08)}
</style>
